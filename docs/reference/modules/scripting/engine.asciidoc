[[modules-scripting-engine]]
=== 使用脚本引擎的高级脚本

`脚本引擎` 是实现脚本语言的后端。它也可以用于编写需要使用脚本的高级内部脚本。例如，在评分时使用词语频率的脚本。

插件 {plugins}/plugin-authors.html[documentation] 提供了有关如何编写一个插件，以便 ElasticSearch 能够正确加载它的更多信息。要注册 `脚本引擎`，插件应实现 `ScriptPlugin` 接口并重写 `getScriptEngine(Settings settings)` 方法。

下面是使用名为 `expert_scripts` 的语言的自定义 `脚本引擎` 示例。它实现了一个名为 `pure_df` 脚本，可以用作搜索脚本来覆盖每个文档的分数为提供的词语的文档频率。

["source","java",subs="attributes,callouts,macros"]
--------------------------------------------------
include-tagged::{plugins-examples-dir}/script-expert-scoring/src/main/java/org/elasticsearch/example/expertscript/ExpertScriptPlugin.java[expert_engine]
--------------------------------------------------

您可以通过将脚本的 `lang` 指定为 `expert_scripts` 以及脚本名称作为脚本源来执行该脚本：


[source,js]
--------------------------------------------------
POST /_search
{
  "query": {
    "function_score": {
      "query": {
        "match": {
          "body": "foo"
        }
      },
      "functions": [
        {
          "script_score": {
            "script": {
                "source": "pure_df",
                "lang" : "expert_scripts",
                "params": {
                    "field": "body",
                    "term": "foo"
                }
            }
          }
        }
      ]
    }
  }
}
--------------------------------------------------
// CONSOLE
// TEST[skip:we don't have an expert script plugin installed to test this]
