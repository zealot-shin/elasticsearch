[[allocation-filtering]]
=== 分片分配过滤

尽管<<index-modules-allocation, 索引-模块-分配>>提供了索引级别的设定来控制分片到节点的分配，集群级别的分片分配过滤允许你开启或者禁用 *任意* 索引的分片到特定节点的分配。

可用的 _动态_ 集群设定如下所示，其中 `{attribute}` 指的是任意节点属性：

`cluster.routing.allocation.include.{attribute}`::

    分配分片到节点，该节点的 `{attribute}` 必须至少有一个可用逗号分隔的值。

`cluster.routing.allocation.require.{attribute}`::

    仅分配分片到 `{attribute}` 具有全部逗号分隔的值的节点。

`cluster.routing.allocation.exclude.{attribute}`::

    不分配分片到 `{attribute}` 具有 _任意_ 逗号分隔的值的节点。

也支持以下这些特殊的属性：

[horizontal]
`_name`::   通过节点名称匹配节点
`_ip`::     通过 IP（IP 地址与域名相关）地址匹配节点
`_host`::   通过域名匹配节点

典型的集群范围的分片分配过滤的用例是让一个节点退役时，你会想在关闭它之前把该节点的分片迁移到集群中其他节点。

举个例子，我们可以使用 IP 地址来退役一个节点：

[source,js]
--------------------------------------------------
PUT _cluster/settings
{
  "transient" : {
    "cluster.routing.allocation.exclude._ip" : "10.0.0.1"
  }
}
--------------------------------------------------
// CONSOLE

NOTE: 分片只会在不破坏其他路由约束的情形下去重分配，比如切忌把主分片和其副本分配到同一个节点。

除了使用逗号分隔的列表来列举多个值以外，全部属性值都可使用通配符来指定，例如：

[source,js]
------------------------
PUT _cluster/settings
{
  "transient": {
    "cluster.routing.allocation.exclude._ip": "192.168.2.*"
  }
}
------------------------
// CONSOLE
